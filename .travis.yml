sudo: required
dist: trusty
language: python
python:
  - "3.6"
before_install:
  # Setup virtual framebuffer
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
install:
  # Install testing tools
  - pip install pytest pytest-cov coveralls vimrunner
  # Install to both virtualenv and outside it, vim needs it too
  - sudo pip install pytest pytest-cov coveralls vimrunner
  # Setup Mnemosyne
  - sudo apt-get update -qq
  - sudo apt-get install -qq libicu52 python-cherrypy3 python-matplotlib python3-pyqt5 pyqt5-dev-tools python3-nose python3-decorator python3-webob python3-matplotlib
  - sudo pip3 install pyqt5
  - pip install pyqt5
  - pushd /tmp
  - wget https://github.com/mnemosyne-proj/mnemosyne/archive/2.6.zip
  - unzip 2.6.zip
  - pushd mnemosyne-2.6/
  - cd mnemosyne/pyqt_ui
  - sudo make install-system
  - cd -
  # Install Mnemosyne libraries both system-wide and to virtualenv
  - sudo python setup.py install
  - sudo ls /home/travis/virtualenv/
  - sudo /home/travis/virtualenv/python3.6.3/bin/python setup.py install
  - popd
  - popd
  - mnemosyne --version
  # Setup Gvim
  - sudo apt-get install -qq vim-gnome
  - gvim --version
  # Setup vimwiki
  - mkdir -p ~/.vim/bundle
  - pushd ~/.vim/bundle
  - git clone https://github.com/vimwiki/vimwiki.git
  - popd
  - pushd ~/.vim/bundle/vimwiki/
  - git checkout dev
  - popd
  # Setup taskwiki
  - cp -r $TRAVIS_BUILD_DIR ~/.vim/bundle/knowledge
  - mkdir ~/knowledge-coverage
before_script:
  - cd ~/.vim/bundle/knowledge
script:
  - py.test -vv --cov .
  - ls ~/knowledge-coverage
  - mv ~/knowledge-coverage/.coverage.* . || echo ok
  - coverage combine
  - coverage report
after_success:
  - coveralls
